<html>
    <head>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
              integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
              crossorigin=""/>
        <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
                integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
                crossorigin=""></script>
    </head>
    <body>
        <div id="adventures_map" style="height: 70vh; width: 80vw"></div>
    </body>
    <script>
        const adventures_map = L.map('adventures_map').setView([42, -115], 5);
        L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
            maxZoom: 17,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="https://opentopomap.org">OpenTopoMap</a>'
        })
            .addTo(adventures_map);

        function buildDescription(adventure){
            if (adventure.amateurs && adventure.distance && adventure.mode) {
                console.log(adventure.amateurs);
                let prefix;
                if (adventure.amateurs.length === 1) {
                    prefix = `${adventure.amateurs[0]} ${adventure.mode}s`;
                }
                else if (adventure.amateurs.length === 2) {
                    prefix = `${adventure.amateurs[0]} and ${adventure.amateurs[1]} ${adventure.mode}`;
                }
                else {
                    const amateurList = `${adventure.amateurs.slice(0,adventure.amateurs.length - 1).join(',')} and ${adventure.amateurs[adventure.amateurs.length - 1]}`;
                    prefix = `${amateurList} ${adventure.mode}`;
                }

                return `${prefix} ${adventure.distance} miles.`;
            }
            else {
                // use the youtube description
                return adventure.description;
            }

        }

        fetch('/adventures.json')
            .then(r => r.json())
            .then(adventures => {
                adventures.forEach(a => {
                    const marker = L.marker([a.latitude, a.longitude]).addTo(adventures_map);
                    marker.bindPopup(`
                        <b>${a.title}</b>
                        <br/>
                        <p>${buildDescription(a)}</p>
                        <a href="${`https://www.youtube.com/watch?v=${a.id}`}">
                            <img src="${`/images/${a.id}.jpg`}" style="width:150px;height:100px;"/>
                        </a>
                        ${a.strava_link ? `<br/><a href="${a.strava_link}">Strava Link</a>` : ""}
                    `);
                });
            });
        const marker = L.marker([40.2548, -105.6159]).addTo(adventures_map);


    </script>
</html>